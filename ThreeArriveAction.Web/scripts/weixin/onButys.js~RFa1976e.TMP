var scrolled = false;
/*下拉加载*/
window.onscroll = function () {
    if (!scrolled) {
        scrolled = true;
        var t = document.documentElement.scrollTop || document.body.scrollTop;
        var t1 = t + $(window).height();
        var h = document.body.scrollHeight;
        if (!scrolled) {
            //下拉加载
            if (t1 >= h) {
                vm.getpage(vm.page + 1);
            }
        }
    }
}

var vm = new Vue({
    el: "#app",
    data: {
        ddlvillage: -1,
        page: 0,
        size: 5,
        totle: 0,
        list: []
    },
    methods: {
        getpage: function (page) {
            var that = this;
            $.ajax({
                type: "post",
                url: "../Ajax/sys_OnButysManager.ashx?type=getOnButysList",
                data: {
                    page: page,
                    size: that.size,
                    ddlvillage: that.ddlvillage
                },
                complete: function (d) {
                    var obj = JSON.parse(d.responseText);
                    that.page = obj.page;
                    that.totle = obj.totle;
                    that.list = obj.list;
                    if (that.page > 1) {
                        $("#lastpage").attr("disabled", false);
                    } else {
                        $("#lastpage").attr("disabled", true);
                    }
                    if (that.page < (that.totle / that.size)) {
                        $("#nextpage").attr("disabled", false);
                    } else {
                        $("#nextpage").attr("disabled", true);
                    }
                    scrolled = false;
                }
            });
        }
    },
    watch: {
        ddlvillage: function () {
            this.getpage(1);
        }
    },
    mounted: function () {
        this.getpage(1);
    }
});


